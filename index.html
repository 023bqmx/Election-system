<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E-Voting System</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="userView">
        <header>
            <h1>E-Voting</h1>
            <p>กรุณาเลือกผู้สมัครที่ท่านต้องการ</p>
        </header>

        <div class="container">
            <div class="party-grid">
                <div class="party-card" onclick="selectParty(1)">
                    <div class="checkmark">✓</div>
                    <div class="party-img" style="background:#FF6B6B">1</div>
                    <div class="party-name">พรรคที่ 1</div>
                    <div style="font-size:0.8rem; color:#888;">หมายเลข 1</div>
                </div>

                <div class="party-card" onclick="selectParty(2)">
                    <div class="checkmark">✓</div>
                    <div class="party-img" style="background:#4ECDC4">2</div>
                    <div class="party-name">พรรคที่ 2</div>
                    <div style="font-size:0.8rem; color:#888;">หมายเลข 2</div>
                </div>

                <div class="party-card" onclick="selectParty(3)">
                    <div class="checkmark">✓</div>
                    <div class="party-img" style="background:#FFE66D; color:#333">3</div>
                    <div class="party-name">พรรคที่ 3</div>
                    <div style="font-size:0.8rem; color:#888;">หมายเลข 3</div>
                </div>

                <div class="party-card" onclick="selectParty(4)">
                    <div class="checkmark">✓</div>
                    <div class="party-img" style="background:#1A535C">4</div>
                    <div class="party-name">พรรคที่ 4</div>
                    <div style="font-size:0.8rem; color:#888;">หมายเลข 4</div>
                </div>
            </div>

            <button class="vote-no-btn" onclick="selectNoVote()">
                ไม่ประสงค์ลงคะแนน
            </button>
        </div>

        <div class="admin-trigger" onclick="openAdminLogin()">⚙️</div>
    </div>

    <div id="adminPanel">
        <header style="display:flex; justify-content:space-between; align-items:center;">
            <h1>Admin Dashboard</h1>
            <button class="btn btn-cancel" style="flex:none;" onclick="logoutAdmin()">ออก</button>
        </header>
        
        <div class="container">
            <div class="chart-container">
                <h3>สรุปคะแนน (Pie Chart)</h3>
                <canvas id="pieChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h3>สรุปคะแนน (Bar Chart)</h3>
                <canvas id="barChart"></canvas>
            </div>

            <div class="chart-container">
                <h3>ประวัติการลงคะแนน</h3>
                <p style="font-size:0.8rem; color:#666; margin-bottom:10px;">กดปุ่มลบ เพื่อรีเซ็ตสิทธิ์ของเครื่องนั้นๆ</p>
                <ul class="history-list" id="voteHistoryList">
                    </ul>
            </div>
            
            <button class="btn btn-danger" style="width:100%" onclick="nukeAllData()">ล้างข้อมูลการเลือกตั้งทั้งหมด</button>
        </div>
    </div>

    <div class="modal-overlay" id="confirmModal">
        <div class="modal-box">
            <div class="modal-title">ยืนยันการเลือก</div>
            <p class="modal-desc" id="confirmText">คุณต้องการเลือก พรรค... ใช่หรือไม่?</p>
            <div class="btn-group">
                <button class="btn btn-cancel" onclick="closeModal('confirmModal')">ยกเลิก</button>
                <button class="btn btn-confirm" onclick="submitVote()">ยืนยัน</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="successModal">
        <div class="modal-box">
            <div style="font-size: 3rem; margin-bottom: 10px;">✅</div>
            <div class="modal-title">เสร็จสมบูรณ์</div>
            <p class="modal-desc">ขอบคุณที่ใช้สิทธิลงคะแนน</p>
            <button class="btn btn-confirm" onclick="closeModal('successModal')">ตกลง</button>
        </div>
    </div>

    <div class="modal-overlay" id="adminLoginModal">
        <div class="modal-box">
            <div class="modal-title">Admin Login</div>
            <p class="modal-desc">กรุณาใส่รหัสผ่านเพื่อเข้าถึงระบบ</p>
            <input type="password" id="adminPin" class="pin-input" maxlength="6" placeholder="******">
            <div class="btn-group">
                <button class="btn btn-cancel" onclick="closeModal('adminLoginModal')">ปิด</button>
                <button class="btn btn-confirm" onclick="checkAdminPassword()">เข้าสู่ระบบ</button>
            </div>
        </div>
    </div>

    <script type="module">
        // เราจะเขียน Logic ใน script.js แต่ต้อง Import Module แบบนี้
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ทำให้ฟังก์ชัน Firebase ใช้ได้ทั่วทั้งโปรเจกต์ (ส่งไปให้ script.js ใช้)
        window.firebaseModules = { initializeApp, getDatabase, ref, push, onValue, remove, set };
    </script>

    <script type="module" src="script.js"></script>
</body>
</html>